<!DOCTYPE html>
<html data-bs-theme="dark">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yuna AI - Modern Interface</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/index.css">
    <script src="/static/js/index.js" defer></script>
    <script src="/static/js/history.js" defer></script>
    <script src="/static/js/kanojo.js" defer></script>
    <script src="/static/js/dairy.js" defer></script>
</head>

<body>
    <!-- Yuna Avatar -->
    <img src="/static/img/yuna-girl-head.webp" class="yuna-avatar" onclick="toggleFloatingMenu()">

    <!-- Top Menu -->
    <div class="top-menu" id="floatingMenu">
        <button class="menu-button" onclick="togglePanel('kanojo')" aria-label="Kanojo">
            <i class="fas fa-user"></i>
        </button>
        <button class="menu-button" onclick="togglePanel('history')" aria-label="History">
            <i class="fas fa-history"></i>
        </button>
        <button class="menu-button" onclick="togglePanel('creator')" aria-label="Creator">
            <i class="fas fa-magic"></i>
        </button>
        <button class="menu-button" onclick="togglePanel('himitsu')" aria-label="Himitsu">
            <i class="fas fa-star"></i>
        </button>
        <button class="menu-button" onclick="togglePanel('diary')" aria-label="Diary">
            <i class="fas fa-book"></i>
        </button>
        <button class="menu-button" onclick="showCallModal()" aria-label="Call">
            <i class="fas fa-phone"></i>
        </button>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="closeAllPanels()"></div>

    <!-- Main Chat Area -->
    <div class="chat-container" id="chatContainer">
        <div class="message message-ai">
            Hello! I'm Yuna, your adorable AI companion. How can I assist you today?
        </div>
        <div class="message message-user">
            Hi Yuna! I'm excited to chat with you.
        </div>
        <div class="message message-ai">
            That's wonderful! Let's make our conversations fun and productive.
        </div>
    </div>

    <!-- Input Area -->
    <div class="input-area">
        <div class="input-group">
            <button class="btn btn-outline-secondary attach-button" aria-label="Attach">
                <i class="fas fa-paperclip"></i>
            </button>
            <input type="text" class="form-control" placeholder="Message Yuna..." aria-label="Message Yuna"
                id="messageInput">
            <button class="btn send-button" aria-label="Send" onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Sliding Panels -->
    <!-- Kanojo Panel -->
    <div id="kanojoPanel" class="popup-panel">
        <button class="close-button" onclick="togglePanel('kanojo')">&times;</button>
        <h4 class="mb-4">Yuna Customization</h4>
        <div class="diary-card accordion" id="kanojoAccordion">
            <!-- Profile and Personality Section -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#profilePersonalityCollapse">
                        Profile & Personality
                    </button>
                </h2>
                <div id="profilePersonalityCollapse" class="accordion-collapse collapse show"
                    data-bs-parent="#kanojoAccordion">
                    <div class="accordion-body">
                        <!-- Kanojo Manager -->
                        <div class="mb-3">
                            <h5 class="card-title">Kanojo Management</h5>
                            <div class="mb-3">
                                <label for="kanojoSelect" class="form-label">Select Kanojo</label>
                                <select class="form-select" id="kanojoSelect">
                                    <option value="Yuna">Yuna</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <button type="button" class="btn btn-primary" id="saveKanojo">Save</button>
                                <button type="button" class="btn btn-primary" id="addKanojo">Add</button>
                                <button type="button" class="btn btn-secondary" id="deleteKanojo">Delete</button>
                            </div>
                            <div class="mb-3">
                                <button type="button" class="btn btn-primary" id="exportKanojos">Export All</button>
                                <button type="button" class="btn btn-primary" id="importKanojos">Import All</button>
                            </div>
                            <div class="mb-3">
                                <button type="button" class="btn btn-primary" id="exportSingleKanojo">Export
                                    Single</button>
                                <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                                    data-bs-target="#fileModal">Import Single</button>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="kanojoName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="kanojoName">
                        </div>
                        <div class="mb-3">
                            <label for="kanojoMemory" class="form-label">Memory</label>
                            <textarea class="form-control" id="kanojoMemory" style="height: 100px"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="kanojoCharacter" class="form-label">Character</label>
                            <textarea class="form-control" id="kanojoCharacter" style="height: 100px"></textarea>
                        </div>

                        <!-- Prompt Template Manager -->
                        <div class="mb-3">
                            <h5 class="card-title">Prompt Templates</h5>
                            <div class="mb-3">
                                <label for="promptTemplateSelect" class="form-label">Select Prompt Template</label>
                                <select class="form-select" id="promptTemplateSelect">
                                    <option value="Default">Default</option>
                                    <option value="Creative">Creative</option>
                                    <option value="Professional">Professional</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="promptTemplateName" class="form-label">Prompt Template Name</label>
                                <input type="text" class="form-control" id="promptTemplateName">
                            </div>
                            <div class="mb-3">
                                <label for="promptTemplateContent" class="form-label">Prompt Template Content</label>
                                <textarea class="form-control" id="promptTemplateContent"
                                    style="height: 100px"></textarea>
                            </div>
                            <button type="button" class="btn btn-primary" id="savePromptTemplate">Save</button>
                            <button type="button" class="btn btn-secondary" id="cancelPromptTemplate">Cancel</button>
                            <button type="button" class="btn btn-danger" id="deletePromptTemplate">Delete</button>
                            <button type="button" class="btn btn-primary" id="exportPromptTemplates">Export All</button>
                            <button type="button" class="btn btn-primary" id="importPromptTemplates">Import All</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Features Section -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#featuresCollapse">
                        Features
                    </button>
                </h2>
                <div id="featuresCollapse" class="accordion-collapse collapse" data-bs-parent="#kanojoAccordion">
                    <div class="accordion-body">
                        <div class="row">
                            <div class="col-md-4">
                                <h6>Himitsu Actions</h6>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="pseudoApi">
                                    <label class="form-check-label">Pseudo API</label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="functions">
                                    <label class="form-check-label">Functions</label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="notifications">
                                    <label class="form-check-label">Notifications</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <h6>Configuration</h6>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="customConfig">
                                    <label class="form-check-label">Custom Config</label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="sounds">
                                    <label class="form-check-label">Sounds</label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="useHistory">
                                    <label class="form-check-label">Use History</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <h6>General</h6>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="backgroundCall">
                                    <label class="form-check-label">Background Call</label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="nsfw">
                                    <label class="form-check-label">NSFW</label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="streaming">
                                    <label class="form-check-label">Streaming</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Config Section -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#advancedCollapse">
                        Advanced Config
                    </button>
                </h2>
                <div id="advancedCollapse" class="accordion-collapse collapse" data-bs-parent="#kanojoAccordion">
                    <div class="accordion-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Max New Tokens</label>
                                <input type="number" class="form-control" id="maxNewTokens" value="1024">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Context Length</label>
                                <input type="number" class="form-control" id="contextLength" value="8192">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Temperature</label>
                                <input type="number" step="0.1" class="form-control" id="temperature" value="0.7">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Top P</label>
                                <input type="number" step="0.1" class="form-control" id="topP" value="0.9">
                            </div>
                        </div>
                        <button class="btn btn-secondary mt-3" onclick="saveAdvancedConfig()">Save Config</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- File Import Modal -->
    <div class="modal fade" id="fileModal" tabindex="-1" aria-labelledby="fileModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="fileModalLabel">Import Kanojo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="file" id="fileInput" accept=".json">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="fileSubmit">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- History Panel -->
    <div id="historyPanel" class="popup-panel">
        <button class="close-button" onclick="togglePanel('history')">&times;</button>
        <h4 class="mb-4">Chat History</h4>
        <button id="createChatButton" class="btn btn-sm btn-success mb-2">Create New Chat</button>
        <ul id="chatList" class="list-group">
            <!-- Chats will be dynamically populated here -->
        </ul>
    </div>

    <!-- Creator Panel -->
    <div id="creatorPanel" class="popup-panel">
        <button class="close-button" onclick="togglePanel('creator')">&times;</button>
        <h4 class="mb-4">Himitsu Creator</h4>
        <div class="diary-card">
            <div class="row g-4">
                <!-- Draft Area -->
                <div class="col-md-4">
                    <div class="form-group">
                        <h5 class="mb-3">Draft Area</h5>
                        <textarea class="form-control" id="draft-area" placeholder="Draft will appear here..."
                            style="resize: none; height: 100px;" spellcheck="false"></textarea>
                    </div>
                </div>
                <!-- General Area -->
                <div class="col-md-4">
                    <div class="form-group">
                        <h5 class="mb-3">General Area</h5>
                        <textarea class="form-control" id="general-area" placeholder="Enter content..."
                            style="resize: none; height: 100px;"></textarea>
                    </div>
                </div>
                <!-- Output Area -->
                <div class="col-md-4">
                    <div class="form-group">
                        <h5 class="mb-3">Output Area</h5>
                        <textarea class="form-control" id="output-area" placeholder="Output will appear here..."
                            style="resize: none; height: 100px;"></textarea>
                    </div>
                </div>
            </div>
            <div class="mt-4">
                <button type="button" class="btn btn-primary">Help</button>
                <button type="button" class="btn btn-success">Create</button>
                <button type="button" class="btn btn-secondary">Copy to Draft</button>
                <button type="button" class="btn btn-primary">Export Presentation</button>
                <button type="button" class="btn btn-danger">Clear</button>
            </div>
            <div class="mt-4">
                <h5>Presentation</h5>
                <div id="presentation-content" class="slide-container mb-4 p-3 border rounded"></div>
            </div>
        </div>
    </div>

    <!-- Himitsu Panel -->
    <div id="himitsuPanel" class="popup-panel">
        <button class="close-button" onclick="togglePanel('himitsu')">&times;</button>
        <h4 class="mb-4">Himitsu</h4>
        <div class="diary-card">
            <h5>Secrets</h5>
            <div class="mb-3">
                <label for="secretTitle" class="form-label">Title</label>
                <input type="text" class="form-control" id="secretTitle" placeholder="Enter title">
            </div>
            <div class="mb-3">
                <label for="secretContent" class="form-label">Content</label>
                <textarea class="form-control" id="secretContent" rows="4" placeholder="Enter content"></textarea>
            </div>
            <button type="button" class="btn btn-primary">Save Secret</button>
        </div>
    </div>

    <!-- Diary Panel -->
    <div id="diaryPanel" class="popup-panel">
        <button class="close-button" onclick="togglePanel('diary')">&times;</button>
        <h4 class="mb-4">Diary</h4>
        <div class="diary-card">
            <h5>Create Note</h5>
            <form id="note-form">
                <div class="mb-3">
                    <label for="noteTitle" class="form-label">Title</label>
                    <input type="text" class="form-control" id="noteTitle" placeholder="Enter title" required>
                </div>
                <div class="mb-3">
                    <label for="noteContent" class="form-label">Content</label>
                    <textarea class="form-control" id="noteContent" rows="4" placeholder="Write your note..."
                        required></textarea>
                </div>
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="isScheduled" onclick="toggleDateField()">
                    <label class="form-check-label" for="isScheduled">Add Date for Scheduled Entry</label>
                </div>
                <div class="mb-3" id="dateField" style="display: none;">
                    <label for="noteDate" class="form-label">Date</label>
                    <input type="date" class="form-control" id="noteDate">
                </div>
                <button type="submit" class="btn btn-primary">Save Note</button>
            </form>
        </div>
        <div class="diary-card mt-4">
            <h5>Previous Notes</h5>
            <div id="notes-container">
                <!-- Notes will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- Updated Call Modal -->
    <div class="modal fade" id="callModal" tabindex="-1" aria-labelledby="callModalLabel" aria-hidden="true"
        data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-fullscreen modal-dialog-centered">
            <div class="modal-content modal-custom">
                <div class="modal-header border-0">
                    <h5 class="modal-title" id="callModalLabel">Call with Yuna</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                        onclick="resetCallUI()"></button>
                </div>
                <div class="call-container" id="callContainer">
                    <div class="video-frame">
                        <img src="/static/img/yuna-call.png" alt="Yuna Call" class="w-100 h-100 object-fit-cover">
                    </div>
                    <div class="video-frame">
                        <video id="localVideo" class="w-100 h-100" muted autoplay></video>
                    </div>
                </div>
                <div class="controls-bar">
                    <button class="control-button" aria-label="Mute/Unmute Microphone"><i
                            class="fas fa-microphone"></i></button>
                    <button class="control-button" aria-label="Start/Stop Video"><i class="fas fa-video"></i></button>
                    <button class="control-button" aria-label="Switch to Audio" onclick="switchToAudio()">
                        <i class="fas fa-phone"></i>
                    </button>
                    <button class="control-button" style="background: #dc3545;" aria-label="End Call"
                        onclick="endCall()">
                        <i class="fas fa-phone-slash"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Pinned Menu -->
    <div class="pinned" id="pinnedMenu">
        <button class="menu-button" onclick="togglePanel('history')" aria-label="History">
            <i class="fas fa-history"></i>
        </button>
        <button class="menu-button" onclick="togglePanel('creator')" aria-label="Creator">
            <i class="fas fa-magic"></i>
        </button>
        <button class="menu-button" onclick="togglePanel('diary')" aria-label="Diary">
            <i class="fas fa-book"></i>
        </button>
        <button class="menu-button" onclick="showCallModal()" aria-label="Call">
            <i class="fas fa-phone"></i>
        </button>
    </div>

    <script src="/static/js/bootstrap.min.js"></script>
</body>

</html>